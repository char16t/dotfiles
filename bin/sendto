#!/bin/bash

if [ $# -lt 2 ]
then
  echo "Usage: sendto <email> <file> [file [file ...]]"
  exit 1
fi

if [ $# -eq 2 ]
then
  subject="File $(basename 2)"
fi

if [ $# -gt 2 ]
then
  subject="Files"
fi

v_mailpart="$(uuidgen)/$(hostname)"
msmtp -a default -i -t <<END
From: v@manenkov.com
To: $1
Subject: $subject
Content-Type: multipart/mixed; boundary=\"$v_mailpart\"
MIME-Version: 1.0

This is a multi-part message in MIME format.
--$v_mailpart
Content-Type: text/html
Content-Disposition: inline

<p>See files in the attachment</p>

-- <br />
Reguards,<br />
<a href="http://v.manenkov.com">Valeriy Manenkov</a>

$(shift && while test ${#} -gt 0
do
    echo "--$v_mailpart"
    echo "Content-Transfer-Encoding: base64"
    echo "Content-Type: application/octet-stream; name=$(basename $1)"
    echo "Content-Disposition: attachment; filename=$(basename $1)"
    echo "$(base64 $1)"
    shift
done)

END
